<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<title>Queen Web Broker</title>
	<script type="text/javascript" src="js/socket.io.dev.js"></script>
	<script type="text/javascript" src="js/queenbridge.js"></script>
</head>
<body style='overflow: hidden'>
	<form action="/login" method="post">
		<div>
		<label id="connectStatus" style="color: red">server disconnected</label>
		<br/><br/>
		<label id="registerStatus" style="color: black">server unregistered</label>
		<br/><br/>
		</div>
		<div>
		<label>srcId</label>
		<input type="text" size=40 name="" id="srcId"/>
		<button onclick="genarateAbonentId();return false">generate</button>
		<button onclick="qwbrokerRegister();return false">register</button>
		<br/><br/>
		</div>
		<div>
		<label>dstId</label>
		<input type="text" size=40 name="" id="dstId"/>
		<br/><br/>
		</div>
		<div>
		<label>message</label>
		<input type="text" size=40 name="" id="payload" value="{'data': '<<<>>>'}"/>
		<button onclick="qwbrokerMessage();return false">send</button>
		<br/><br/>
		</div>
		<div>
		<textarea id="logger" cols="80" rows="10"></textarea>
		</div>
	</form>	
	<script>
		// init GUI objects
		connectStatus = document.getElementById("connectStatus");
		registerStatus = document.getElementById("registerStatus");
		srcId = document.getElementById("srcId");
		dstId = document.getElementById("dstId");
		payload = document.getElementById("payload");
		logger = document.getElementById("logger");
		qb = new QueenBridge(location.host, {id: 'sio1'});
		qb.on('connect', function() {
			connectStatus.style.color = 'green';
			connectStatus.innerHTML = 'server connected';
		});
		qb.on('disconnect', function() {
			connectStatus.style.color = 'red';
			connectStatus.innerHTML = 'server disconnected';
		});
		qb.on('register', function(data) {
			registerStatus.innerHTML = 'server registered as: ' + data.id ? data.id : data.error;
		});
		qb.on('abonents', function(data) {
			console.log(data);
		});
		qb.on('receive', function(data) {
			console.log(data);
		});
		
		qb.send('/api/abonents');
		/*
		genarateAbonentId();
		qwbrokerRegister()
		// init qwio object
		qwio.connect(location.host, (event, data) => {
			if (event === "connect") {
				connectStatus.style.color = 'green';
				connectStatus.innerHTML = 'server connected';
				console.log('server connected');
			}
			if (event === "disconnect") {
				connectStatus.style.color = 'red';
				connectStatus.innerHTML = 'server disconnected';
				console.log('server disconnected');
			}
			if (event === "error") {
				console.log('error: ' + data);		
			}
			if (event === "message") {
				logger.value += data;
			}
		});		
		// button slots
		function genarateAbonentId() {
			srcId.value = UUID();
		}
		function qwbrokerRegister() {
			qwio.register(srcId.value);
		}
		function qwbrokerMessage() {
			qwio.send(dstId.value, payload.value);
		}
		*/
	</script>
	
</body>
</html>
